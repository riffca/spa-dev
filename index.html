<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	<div data-component="layout" data-layout="relative">
		<div>
			<a href="#profile">Profile</a>
			<a href="#lazy">lazy</a>
		</div>
		<div data-view></div>
	</div>


	<div
		class="target"
		data-text="Hohu"
		data-list="create,нахуй, все блад"
		data-component="button">
	</div>


	<div
		data-text="Pizda"
		data-component="button"
		class="component-button">
	</div>


	<div 
		data-list="Pop,Up,Grate,Home,New"
		data-component="list"
		class="component-list">
	</div>

	<div 
		data-list="1,2,3,4,5"
		data-component="list"
		class="component-list">
	</div>


	<div 
		data-component="images"
		data-images="google.com,2,3,4,5,6"
		class="component-images">
	</div>
	<div 
		data-component="clone"
		data-target="[data-component=images]">
	</div>


	<div id="container"></div>
	<script type="module">
		import { initDomApp } from './js/app.js'

		const listeners = new Map()

		function addEventListener(target, event, handler){
			target.addEventListener(event, handler)
			listeners.set(handler, target)
		}

		function bindElement(selector, extend){
			const app = {
				lib: {
					target: document.querySelector(selector),
					setAttribute(attr, val){
						this.target.setAttribute('data-'+ attr, val)
					}
				},
				...extend
			}

			if(extend.click) {
				addEventListener(app.lib.target,'click',extend.click)
			}

			const wrap = new Proxy(app, {
			  set(target, prop, value) {
			  	console.log(target, prop)
				target[prop] = value

				if(typeof value === 'object') {
					app.lib.setAttribute(prop, JSON.stringify(value))
				} else {
					app.lib.setAttribute(prop, value)

				}
				//return Reflect.set(target, prop, value, receiver)
				return true
			  }
			});
			return wrap
		}


		const componentButtonInterface = bindElement('.target',{
			loaded: false,
			companies: [],
			async loadCompanies(){
				const response = await Promise.resolve([{name: 'one', name: 'two'}])
				this.loaded = true
				this.companies = JSON.stringify(response)
			}

			click: ()=>{
				componentButtonInterface.text = "Vova"; 
				componentButtonInterface.children = [1,2,3,4,5]
				componentButtonInterface.loadCompanies()
			}
		})


		function loadImage() {
			const imgs = fetch('img').then(data=>res.json())
			componentButtonInterface.images = imgs
		}


		// setTimeout(async ()=>{ 
		// 	componentButtonInterface.text = "Vova"; 
		// 	componentButtonInterface.children = [1,2,3,4,5]
		// 	componentButtonInterface.loadCompanies()
		// },2000)




		initDomApp([
			{
				name: 'clone',
				attrs(key, value, target){
					if(key === 'data-target') {
						const targetClone = document.querySelector(value)
						target.replaceChildren(targetClone)
					}
				}
			},
		])

	</script>
	
</body>
</html>